var b=Object.defineProperty;var P=(g,l,c)=>l in g?b(g,l,{enumerable:!0,configurable:!0,writable:!0,value:c}):g[l]=c;var p=(g,l,c)=>P(g,typeof l!="symbol"?l+"":l,c);import{S as x,a as z,C as f,W as A,P as D,O as L,b as F,G as H,d as O,e as N,A as S,M as R,c as J,B as K,V as B}from"./lil-gui.esm-sgHxfc29.js";const C={maxCol:21,maxRow:16,cellInfos:[{cellId:"A1"},{cellId:"A2"},{cellId:"A3",originId:"A3",fmsType:"ups",direction:"S",rowGrid:1,colGrid:2},{cellId:"A4",originId:"A3"},{cellId:"A5"},{cellId:"A6",originId:"A6",fmsType:"ups",direction:"S",rowGrid:1,colGrid:2},{cellId:"A7",originId:"A6"},{cellId:"A8"},{cellId:"A9",originId:"A9",fmsType:"ups",direction:"S",rowGrid:1,colGrid:2},{cellId:"A10",originId:"A9"},{cellId:"A11"},{cellId:"A12"},{cellId:"A13"},{cellId:"A14"},{cellId:"A15"},{cellId:"A16"},{cellId:"A17"},{cellId:"A18"},{cellId:"A19"},{cellId:"A20"},{cellId:"A21"},{cellId:"B1"},{cellId:"B2"},{cellId:"B3"},{cellId:"B4"},{cellId:"B5"},{cellId:"B6"},{cellId:"B7"},{cellId:"B8"},{cellId:"B9"},{cellId:"B10"},{cellId:"B11"},{cellId:"B12"},{cellId:"B13"},{cellId:"B14"},{cellId:"B15"},{cellId:"B16"},{cellId:"B17"},{cellId:"B18"},{cellId:"B19"},{cellId:"B20"},{cellId:"B21"},{cellId:"C1"},{cellId:"C2"},{cellId:"C3"},{cellId:"C4"},{cellId:"C5"},{cellId:"C6"},{cellId:"C7"},{cellId:"C8"},{cellId:"C9"},{cellId:"C10"},{cellId:"C11"},{cellId:"C12"},{cellId:"C13"},{cellId:"C14"},{cellId:"C15"},{cellId:"C16"},{cellId:"C17"},{cellId:"C18"},{cellId:"C19"},{cellId:"C20"},{cellId:"C21"},{cellId:"D1"},{cellId:"D2"},{cellId:"D3",originId:"D4"},{cellId:"D4",originId:"D4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"D5"},{cellId:"D6"},{cellId:"D7"},{cellId:"D8",originId:"D9"},{cellId:"D9",originId:"D9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"D10"},{cellId:"D11"},{cellId:"D12"},{cellId:"D13"},{cellId:"D14"},{cellId:"D15",originId:"D15",fmsType:"rack",direction:"S",rowGrid:1,colGrid:2},{cellId:"D16",originId:"D16",fmsType:"rack",direction:"S",rowGrid:1,colGrid:2},{cellId:"D17",originId:"D17",fmsType:"rack",direction:"S",rowGrid:1,colGrid:2},{cellId:"D18",originId:"D18",fmsType:"rack",direction:"S",rowGrid:1,colGrid:2},{cellId:"D19",originId:"D19",fmsType:"rack",direction:"S",rowGrid:1,colGrid:2},{cellId:"D20",originId:"D19"},{cellId:"D21"},{cellId:"E1"},{cellId:"E2"},{cellId:"E3",originId:"E4"},{cellId:"E4",originId:"E4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"E5"},{cellId:"E6"},{cellId:"E7"},{cellId:"E8",originId:"E9"},{cellId:"E9",originId:"E9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"E10"},{cellId:"E11"},{cellId:"E12"},{cellId:"E13"},{cellId:"E14"},{cellId:"E15"},{cellId:"E16"},{cellId:"E17"},{cellId:"E18"},{cellId:"E19"},{cellId:"E20"},{cellId:"E21"},{cellId:"F1"},{cellId:"F2"},{cellId:"F3",originId:"F4"},{cellId:"F4",originId:"F4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"F5"},{cellId:"F6"},{cellId:"F7"},{cellId:"F8",originId:"F9"},{cellId:"F9",originId:"F9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"F10"},{cellId:"F11"},{cellId:"F12"},{cellId:"F13"},{cellId:"F14"},{cellId:"F15"},{cellId:"F16"},{cellId:"F17"},{cellId:"F18"},{cellId:"F19"},{cellId:"F20"},{cellId:"F21"},{cellId:"G1"},{cellId:"G2"},{cellId:"G3",originId:"G4"},{cellId:"G4",originId:"G4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"G5"},{cellId:"G6"},{cellId:"G7"},{cellId:"G8",originId:"G9"},{cellId:"G9",originId:"G9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"G10"},{cellId:"G11"},{cellId:"G12"},{cellId:"G13"},{cellId:"G14"},{cellId:"G15",originId:"G15",fmsType:"rack",direction:"N",rowGrid:1,colGrid:2},{cellId:"G16",originId:"G16",fmsType:"rack",direction:"N",rowGrid:1,colGrid:2},{cellId:"G17",originId:"G17",fmsType:"rack",direction:"N",rowGrid:1,colGrid:2},{cellId:"G18",originId:"G18",fmsType:"rack",direction:"N",rowGrid:1,colGrid:2},{cellId:"G19",originId:"G19",fmsType:"rack",direction:"N",rowGrid:1,colGrid:2},{cellId:"G20"},{cellId:"G21"},{cellId:"H1"},{cellId:"H2"},{cellId:"H3",originId:"H4"},{cellId:"H4",originId:"H4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"H5"},{cellId:"H6"},{cellId:"H7"},{cellId:"H8",originId:"H9"},{cellId:"H9",originId:"H9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"H10"},{cellId:"H11"},{cellId:"H12"},{cellId:"H13"},{cellId:"H14"},{cellId:"H15",originId:"G15"},{cellId:"H16",originId:"G16"},{cellId:"H17",originId:"G17"},{cellId:"H18",originId:"G18"},{cellId:"H19",originId:"G19"},{cellId:"H20"},{cellId:"H21"},{cellId:"I1"},{cellId:"I2"},{cellId:"I3",originId:"I4"},{cellId:"I4",originId:"I4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"I5"},{cellId:"I6"},{cellId:"I7"},{cellId:"I8",originId:"I9"},{cellId:"I9",originId:"I9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"I10"},{cellId:"I11"},{cellId:"I12"},{cellId:"I13"},{cellId:"I14"},{cellId:"I15"},{cellId:"I16"},{cellId:"I17"},{cellId:"I18"},{cellId:"I19"},{cellId:"I20"},{cellId:"I21"},{cellId:"J1"},{cellId:"J2"},{cellId:"J3",originId:"J4"},{cellId:"J4",originId:"J4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"J5"},{cellId:"J6"},{cellId:"J7"},{cellId:"J8",originId:"J9"},{cellId:"J9",originId:"J9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"J10"},{cellId:"J11"},{cellId:"J12"},{cellId:"J13"},{cellId:"J14"},{cellId:"J15"},{cellId:"J16"},{cellId:"J17"},{cellId:"J18"},{cellId:"J19"},{cellId:"J20"},{cellId:"J21"},{cellId:"K1"},{cellId:"K2"},{cellId:"K3",originId:"K4"},{cellId:"K4",originId:"K4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"K5"},{cellId:"K6"},{cellId:"K7"},{cellId:"K8",originId:"K9"},{cellId:"K9",originId:"K9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"K10"},{cellId:"K11"},{cellId:"K12"},{cellId:"K13"},{cellId:"K14"},{cellId:"K15"},{cellId:"K16"},{cellId:"K17"},{cellId:"K18"},{cellId:"K19"},{cellId:"K20"},{cellId:"K21"},{cellId:"L1"},{cellId:"L2"},{cellId:"L3",originId:"L4"},{cellId:"L4",originId:"L4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"L5"},{cellId:"L6"},{cellId:"L7"},{cellId:"L8",originId:"L9"},{cellId:"L9",originId:"L9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"L10"},{cellId:"L11"},{cellId:"L12"},{cellId:"L13"},{cellId:"L14"},{cellId:"L15"},{cellId:"L16"},{cellId:"L17"},{cellId:"L18"},{cellId:"L19"},{cellId:"L20"},{cellId:"L21"},{cellId:"M1"},{cellId:"M2"},{cellId:"M3",originId:"M4"},{cellId:"M4",originId:"M4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"M5"},{cellId:"M6"},{cellId:"M7"},{cellId:"M8",originId:"M9"},{cellId:"M9",originId:"M9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"M10"},{cellId:"M11"},{cellId:"M12"},{cellId:"M13"},{cellId:"M14"},{cellId:"M15"},{cellId:"M16"},{cellId:"M17"},{cellId:"M18"},{cellId:"M19"},{cellId:"M20"},{cellId:"M21"},{cellId:"N1"},{cellId:"N2"},{cellId:"N3"},{cellId:"N4"},{cellId:"N5"},{cellId:"N6"},{cellId:"N7"},{cellId:"N8"},{cellId:"N9"},{cellId:"N10"},{cellId:"N11"},{cellId:"N12"},{cellId:"N13"},{cellId:"N14"},{cellId:"N15"},{cellId:"N16"},{cellId:"N17"},{cellId:"N18"},{cellId:"N19"},{cellId:"N20"},{cellId:"N21"},{cellId:"O1"},{cellId:"O2"},{cellId:"O3"},{cellId:"O4"},{cellId:"O5"},{cellId:"O6"},{cellId:"O7"},{cellId:"O8"},{cellId:"O9"},{cellId:"O10"},{cellId:"O11"},{cellId:"O12"},{cellId:"O13"},{cellId:"O14"},{cellId:"O15"},{cellId:"O16"},{cellId:"O17"},{cellId:"O18"},{cellId:"O19"},{cellId:"O20"},{cellId:"O21"},{cellId:"P1"},{cellId:"P2",originId:"P3"},{cellId:"P3",originId:"P3",fmsType:"crac",direction:"N",rowGrid:2,colGrid:1},{cellId:"P4"},{cellId:"P5",originId:"P6"},{cellId:"P6",originId:"P6",fmsType:"crac",direction:"N",rowGrid:2,colGrid:1},{cellId:"P7"},{cellId:"P8",originId:"P9"},{cellId:"P9",originId:"P9",fmsType:"crac",direction:"N",rowGrid:2,colGrid:1},{cellId:"P10"},{cellId:"P11"},{cellId:"P12"},{cellId:"P13"},{cellId:"P14"},{cellId:"P15"},{cellId:"P16"},{cellId:"P17"},{cellId:"P18"},{cellId:"P19"},{cellId:"P20"},{cellId:"P21"}]},v=["1U","2U","4U","8U","10U"],E=[1,1,1,1,2,2,4,8,10],k={backgroundColor:"#eeeeee"},m={position:{x:10,y:10,z:0},lookAt:{x:0,y:0,z:0}},U=document.querySelector("#app");class W{constructor(){p(this,"_renderer");p(this,"_scene");p(this,"_camera");p(this,"_modelMap",{});p(this,"_deviceTextureMap",{});p(this,"_container",U);p(this,"_stats");this._setup(),this._render()}async _setup(){this._setupScene(),this._setupRenderer(),this._setupCamera(),this._setupLight(),this._setupResize(),this._setupControls(),this.stats=new x,document.body.appendChild(this.stats.dom),await this._loadModels(),this._addModel(),this._renderer.render(this._scene,this._camera)}_setupScene(){this._scene=new z,this._scene.background=new f(k.backgroundColor)}updateBackgroundColor(l){this._scene.background.set(l)}_setupRenderer(){this._renderer=new A({antialias:!0}),this._renderer.setPixelRatio(window.devicePixelRatio),this._container.appendChild(this._renderer.domElement)}_setupCamera(){const{clientWidth:l,clientHeight:c}=this._container;this._camera=new D(75,l/c,.1,1e3),this._camera.position.x=m.position.x,this._camera.position.z=m.position.z,this._camera.position.y=m.position.y,this._camera.lookAt(m.lookAt.x,m.lookAt.y,m.lookAt.z)}_setupLight(){}_setupResize(){const{clientWidth:l,clientHeight:c}=this._container;this._renderer.setSize(l,c),this._camera.aspect=l/c,this._camera.updateProjectionMatrix(),window.addEventListener("resize",this._setupResize.bind(this))}_setupControls(){new L(this._camera,this._container)}_setupHelper(){const l=new F(20);this._scene.add(l)}async _render(){this.stats.begin(),this._renderer.render(this._scene,this._camera),this.stats.end(),requestAnimationFrame(this._render.bind(this))}async _loadModels(){const l=new H,c=["real_rack","rack","tile","wall","crac","ups","battery",...v],o=await Promise.all(c.map(i=>{const d=`/3d_demo/${i}.glb`;return l.loadAsync(d)}));c.forEach((i,d)=>{o[d].scene,this._modelMap[i]=o[d].scene})}_addModel(){this.mapRender(),this.addGUI(),this.invisibleWallRender(),this.visibleWallRender(),this.renderLight()}renderLight(){let l={color:16777215,distance:20,intensity:30,positionDistance:6,helperVisible:!0};const c=[{x:l.positionDistance,y:5,z:0},{x:-l.positionDistance,y:5,z:0},{x:0,y:5,z:0},{x:0,y:5,z:l.positionDistance},{x:0,y:5,z:-l.positionDistance}],o=[],i=[];c.forEach((e,r)=>{const n=new O(l.color,l.intensity,l.distance);n.position.set(e.x,e.y,e.z),this._scene.add(n),o.push(n);const s=new N(n,1,"orange");i.push(s),this._scene.add(s)});const d=new S(4210752,.3);this._scene.add(d);const t=this.gui.addFolder("조명");t.addColor(l,"color").name("빛의 색상").onChange(e=>{o.forEach(r=>{r.color.set(new f(e))})}),t.add(l,"intensity",0,100,1).name("빛의 강도").onChange(e=>{o.forEach(r=>{r.intensity=e})}),t.add(l,"distance",0,100,1).name("조명이 미치는 거리").onChange(e=>{o.forEach(r=>{r.distance=e})}),t.add(l,"positionDistance",0,100,1).name("조명 사이의 거리").onChange(e=>{o[0].position.x=e,o[1].position.x=-e,o[3].position.z=e,o[4].position.z=-e}),t.add(l,"helperVisible").name("광원 헬퍼 토글").onChange(e=>{i.forEach(r=>{r.visible=e})})}invisibleWallRender(){const l=this._modelMap.tile,{x:c}=this.getObjectSize(l),i=this._modelMap.wall.clone();i.traverse(e=>{e instanceof R&&(e.material=e.material.clone(),e.geometry=e.geometry.clone())});const d=i.children[0].children[0].material;d.transparent=!0,d.opacity=.5;const t=this.gui.addFolder("불투명 벽 색상");t.addColor(d,"color").onChange(e=>{d.color.set(new f(e))}),t.add(d,"opacity",0,1,.01).onChange(e=>{d.opacity=e}),i.rotation.y=Math.PI/2,i.position.x-=c/2,i.position.z=c*2,i.scale.set(1,1.2,16),this._scene.add(i)}visibleWallRender(){const l=this._modelMap.tile,{x:c}=this.getObjectSize(l),o=this._modelMap.wall.clone(),i=this.gui.addFolder("투명 벽 색상"),d=o.children[0].children[0].material;d.transparent=!0,d.opacity=.5,i.addColor(d,"color").onChange(a=>{d.color=new f(a)}),i.add(d,"opacity",0,1,.01).onChange(a=>{d.opacity=a});const t=.7,e=o.clone();e.scale.set(1.5,t,5),e.position.x=c*5,e.position.z=c*6.5;const r=e.clone();r.position.x=0,this._scene.add(r),this._scene.add(e);const n=o.clone();n.rotation.y=Math.PI/2,n.scale.set(1.5,t,5),n.position.x=c*2.5,n.position.z=c*4;const s=n.clone();s.position.z=c*9,this._scene.add(n),this._scene.add(s);const I=o.clone(),{x:y,y:w,z:G}=this.getObjectSize(I);I.rotation.z=Math.PI/2,I.position.set(c*5,w*t,c*6.5),I.scale.set(1,1.25,5),this._scene.add(I)}addGUI(){this.gui=new J,this.gui.addFolder("배경 색상").addColor(k,"backgroundColor").onChange(c=>{this._scene.background.set(c)})}wallRender(){const{maxRow:l,maxCol:c}=C,o=this._modelMap.tile,{x:i}=this.getObjectSize(o),d=-1*(c/2)*i,t=l/2*i;for(const e of wallInfo){const[r,n]=e.split("_"),{row:s,col:I}=this.cellIdToRowCol(r),{row:y,col:w}=this.cellIdToRowCol(n);if(I===w){const G=t+s*i,a=d-I*i+i/2,h=this._modelMap.wall.clone();h.position.set(G,0,a),h.rotation.y=Math.PI/2,this._scene.add(h)}if(s===y){const G=t+s*i+i/2,a=d+I*i,h=this._modelMap.wall.clone();h.position.set(G,0,a),this._scene.add(h)}}}mountDevice(l,c){const i=c/79.7,d=1.75,t=4.1;let e=0;for(;;){const r=E[Math.floor(Math.random()*E.length)];if(e+r>=42)break;if(Math.random()<.3){e+=r;continue}const n=this._modelMap[`${r}U`].clone(),I=(e+r/2)*d+t;n.position.y=I*i,l.add(n),e+=r}}getObjectSize(l){const c=new K().setFromObject(l),o=new B;return c.getSize(o),o}mapRender(){const{cellInfos:l,maxRow:c,maxCol:o}=C,i=this._modelMap.tile,{x:d}=this.getObjectSize(i),{y:t}=this.getObjectSize(this._modelMap.rack),e=-1*(o/2)*d,r=c/2*d;for(let n=0;n<l.length;n+=1){const s=l[n],{cellId:I,originId:y}=s,{row:w,col:G}=this.cellIdToRowCol(I),a=e+G*d,h=r-w*d,M=i.clone();if(M.position.set(h,0,a),this._scene.add(M),I!==y)continue;const{fmsType:u,direction:T}=s,_=this._modelMap[u==="rack"?"real_rack":u].clone();_.rotation.y=this.directionToRotation(T),_.position.set(h,0,a),u==="rack"&&(this.mountDevice(_,t),_.scale.set(1.2,1,1.25)),this._scene.add(_)}}directionToRotation(l){if(l==="N")return 0;if(l==="S")return Math.PI;if(l==="E")return Math.PI/2*3;if(l==="W")return Math.PI/2}cellIdToRowCol(l){const c=l.match(/^([A-Z]+)(\d+)$/);if(!c)return null;const[,o,i]=c;let d=0;for(let t=0;t<o.length;t+=1)d=d*26+(o.charCodeAt(t)-64);return{row:d,col:Number(i)}}}new W;
