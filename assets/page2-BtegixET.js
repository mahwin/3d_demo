var T=Object.defineProperty;var P=(u,l,c)=>l in u?T(u,l,{enumerable:!0,configurable:!0,writable:!0,value:c}):u[l]=c;var b=(u,l,c)=>P(u,typeof l!="symbol"?l+"":l,c);import{S as x,a as z,C as w,W as A,P as D,O as L,b as F,G as H,d as O,e as N,A as S,M as R,c as J,B as K,V as B}from"./lil-gui.esm-sgHxfc29.js";const M={maxCol:21,maxRow:16,cellInfos:[{cellId:"A1",placable:!0},{cellId:"A2",placable:!0},{cellId:"A3",originId:"A3",fmsType:"ups",direction:"S",rowGrid:1,colGrid:2},{cellId:"A4",placable:!0,originId:"A3"},{cellId:"A5",placable:!0},{cellId:"A6",originId:"A6",fmsType:"ups",direction:"S",rowGrid:1,colGrid:2},{cellId:"A7",placable:!0,originId:"A6"},{cellId:"A8",placable:!0},{cellId:"A9",originId:"A9",fmsType:"ups",direction:"S",rowGrid:1,colGrid:2},{cellId:"A10",placable:!0,originId:"A9"},{cellId:"A11",placable:!0},{cellId:"A12",placable:!0},{cellId:"A13",placable:!0},{cellId:"A14",placable:!0},{cellId:"A15",placable:!0},{cellId:"A16",placable:!0},{cellId:"A17",placable:!0},{cellId:"A18",placable:!0},{cellId:"A19",placable:!0},{cellId:"A20",placable:!0},{cellId:"A21",placable:!0},{cellId:"B1",placable:!0},{cellId:"B2",placable:!0},{cellId:"B3",placable:!0},{cellId:"B4",placable:!0},{cellId:"B5",placable:!0},{cellId:"B6",placable:!0},{cellId:"B7",placable:!0},{cellId:"B8",placable:!0},{cellId:"B9",placable:!0},{cellId:"B10",placable:!0},{cellId:"B11",placable:!0},{cellId:"B12",placable:!0},{cellId:"B13",placable:!0},{cellId:"B14",placable:!0},{cellId:"B15",placable:!0},{cellId:"B16",placable:!0},{cellId:"B17",placable:!0},{cellId:"B18",placable:!0},{cellId:"B19",placable:!0},{cellId:"B20",placable:!0},{cellId:"B21",placable:!0},{cellId:"C1",placable:!0},{cellId:"C2",placable:!0},{cellId:"C3",placable:!0},{cellId:"C4",placable:!0},{cellId:"C5",placable:!0},{cellId:"C6",placable:!0},{cellId:"C7",placable:!0},{cellId:"C8",placable:!0},{cellId:"C9",placable:!0},{cellId:"C10",placable:!0},{cellId:"C11",placable:!0},{cellId:"C12",placable:!0},{cellId:"C13",placable:!0},{cellId:"C14",placable:!0},{cellId:"C15",placable:!0},{cellId:"C16",placable:!0},{cellId:"C17",placable:!0},{cellId:"C18",placable:!0},{cellId:"C19",placable:!0},{cellId:"C20",placable:!0},{cellId:"C21",placable:!0},{cellId:"D1",placable:!0},{cellId:"D2",placable:!0},{cellId:"D3",placable:!0,originId:"D4"},{cellId:"D4",originId:"D4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"D5",placable:!0},{cellId:"D6",placable:!1},{cellId:"D7",placable:!1},{cellId:"D8",placable:!0,originId:"D9"},{cellId:"D9",originId:"D9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"D10",placable:!0},{cellId:"D11",placable:!0},{cellId:"D12",placable:!0},{cellId:"D13",placable:!0},{cellId:"D14",placable:!0},{cellId:"D15",originId:"D15",fmsType:"rack",direction:"S",rowGrid:1,colGrid:2},{cellId:"D16",originId:"D16",fmsType:"rack",direction:"S",rowGrid:1,colGrid:2},{cellId:"D17",originId:"D17",fmsType:"rack",direction:"S",rowGrid:1,colGrid:2},{cellId:"D18",originId:"D18",fmsType:"rack",direction:"S",rowGrid:1,colGrid:2},{cellId:"D19",originId:"D19",fmsType:"rack",direction:"S",rowGrid:1,colGrid:2},{cellId:"D20",placable:!0,originId:"D19"},{cellId:"D21",placable:!0},{cellId:"E1",placable:!0},{cellId:"E2",placable:!0},{cellId:"E3",placable:!0,originId:"E4"},{cellId:"E4",originId:"E4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"E5",placable:!0},{cellId:"E6",placable:!1},{cellId:"E7",placable:!1},{cellId:"E8",placable:!0,originId:"E9"},{cellId:"E9",originId:"E9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"E10",placable:!0},{cellId:"E11",placable:!0},{cellId:"E12",placable:!0},{cellId:"E13",placable:!0},{cellId:"E14",placable:!0},{cellId:"E15",placable:!1},{cellId:"E16",placable:!1},{cellId:"E17",placable:!1},{cellId:"E18",placable:!1},{cellId:"E19",placable:!1},{cellId:"E20",placable:!0},{cellId:"E21",placable:!0},{cellId:"F1",placable:!0},{cellId:"F2",placable:!0},{cellId:"F3",placable:!0,originId:"F4"},{cellId:"F4",originId:"F4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"F5",placable:!0},{cellId:"F6",placable:!1},{cellId:"F7",placable:!1},{cellId:"F8",placable:!0,originId:"F9"},{cellId:"F9",originId:"F9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"F10",placable:!0},{cellId:"F11",placable:!0},{cellId:"F12",placable:!0},{cellId:"F13",placable:!0},{cellId:"F14",placable:!0},{cellId:"F15",placable:!1},{cellId:"F16",placable:!1},{cellId:"F17",placable:!1},{cellId:"F18",placable:!1},{cellId:"F19",placable:!1},{cellId:"F20",placable:!0},{cellId:"F21",placable:!0},{cellId:"G1",placable:!0},{cellId:"G2",placable:!0},{cellId:"G3",placable:!0,originId:"G4"},{cellId:"G4",originId:"G4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"G5",placable:!0},{cellId:"G6",placable:!1},{cellId:"G7",placable:!1},{cellId:"G8",placable:!0,originId:"G9"},{cellId:"G9",originId:"G9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"G10",placable:!0},{cellId:"G11",placable:!0},{cellId:"G12",placable:!0},{cellId:"G13",placable:!0},{cellId:"G14",placable:!0},{cellId:"G15",originId:"G15",fmsType:"rack",direction:"N",rowGrid:1,colGrid:2},{cellId:"G16",originId:"G16",fmsType:"rack",direction:"N",rowGrid:1,colGrid:2},{cellId:"G17",originId:"G17",fmsType:"rack",direction:"N",rowGrid:1,colGrid:2},{cellId:"G18",originId:"G18",fmsType:"rack",direction:"N",rowGrid:1,colGrid:2},{cellId:"G19",originId:"G19",fmsType:"rack",direction:"N",rowGrid:1,colGrid:2},{cellId:"G20",placable:!0},{cellId:"G21",placable:!0},{cellId:"H1",placable:!0},{cellId:"H2",placable:!0},{cellId:"H3",placable:!0,originId:"H4"},{cellId:"H4",originId:"H4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"H5",placable:!0},{cellId:"H6",placable:!1},{cellId:"H7",placable:!1},{cellId:"H8",placable:!0,originId:"H9"},{cellId:"H9",originId:"H9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"H10",placable:!0},{cellId:"H11",placable:!0},{cellId:"H12",placable:!0},{cellId:"H13",placable:!0},{cellId:"H14",placable:!0},{cellId:"H15",placable:!0,originId:"G15"},{cellId:"H16",placable:!0,originId:"G16"},{cellId:"H17",placable:!0,originId:"G17"},{cellId:"H18",placable:!0,originId:"G18"},{cellId:"H19",placable:!0,originId:"G19"},{cellId:"H20",placable:!0},{cellId:"H21",placable:!0},{cellId:"I1",placable:!0},{cellId:"I2",placable:!0},{cellId:"I3",placable:!0,originId:"I4"},{cellId:"I4",originId:"I4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"I5",placable:!0},{cellId:"I6",placable:!1},{cellId:"I7",placable:!1},{cellId:"I8",placable:!0,originId:"I9"},{cellId:"I9",originId:"I9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"I10",placable:!0},{cellId:"I11",placable:!0},{cellId:"I12",placable:!0},{cellId:"I13",placable:!0},{cellId:"I14",placable:!0},{cellId:"I15",placable:!0},{cellId:"I16",placable:!0},{cellId:"I17",placable:!0},{cellId:"I18",placable:!0},{cellId:"I19",placable:!0},{cellId:"I20",placable:!0},{cellId:"I21",placable:!0},{cellId:"J1",placable:!0},{cellId:"J2",placable:!0},{cellId:"J3",placable:!0,originId:"J4"},{cellId:"J4",originId:"J4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"J5",placable:!0},{cellId:"J6",placable:!1},{cellId:"J7",placable:!1},{cellId:"J8",placable:!0,originId:"J9"},{cellId:"J9",originId:"J9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"J10",placable:!0},{cellId:"J11",placable:!0},{cellId:"J12",placable:!0},{cellId:"J13",placable:!0},{cellId:"J14",placable:!0},{cellId:"J15",placable:!0},{cellId:"J16",placable:!0},{cellId:"J17",placable:!0},{cellId:"J18",placable:!0},{cellId:"J19",placable:!0},{cellId:"J20",placable:!0},{cellId:"J21",placable:!0},{cellId:"K1",placable:!0},{cellId:"K2",placable:!0},{cellId:"K3",placable:!0,originId:"K4"},{cellId:"K4",originId:"K4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"K5",placable:!0},{cellId:"K6",placable:!1},{cellId:"K7",placable:!1},{cellId:"K8",placable:!0,originId:"K9"},{cellId:"K9",originId:"K9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"K10",placable:!0},{cellId:"K11",placable:!0},{cellId:"K12",placable:!0},{cellId:"K13",placable:!0},{cellId:"K14",placable:!0},{cellId:"K15",placable:!0},{cellId:"K16",placable:!0},{cellId:"K17",placable:!0},{cellId:"K18",placable:!0},{cellId:"K19",placable:!0},{cellId:"K20",placable:!0},{cellId:"K21",placable:!0},{cellId:"L1",placable:!0},{cellId:"L2",placable:!0},{cellId:"L3",placable:!0,originId:"L4"},{cellId:"L4",originId:"L4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"L5",placable:!0},{cellId:"L6",placable:!1},{cellId:"L7",placable:!1},{cellId:"L8",placable:!0,originId:"L9"},{cellId:"L9",originId:"L9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"L10",placable:!0},{cellId:"L11",placable:!0},{cellId:"L12",placable:!0},{cellId:"L13",placable:!0},{cellId:"L14",placable:!0},{cellId:"L15",placable:!0},{cellId:"L16",placable:!0},{cellId:"L17",placable:!0},{cellId:"L18",placable:!0},{cellId:"L19",placable:!0},{cellId:"L20",placable:!0},{cellId:"L21",placable:!0},{cellId:"M1",placable:!0},{cellId:"M2",placable:!0},{cellId:"M3",placable:!0,originId:"M4"},{cellId:"M4",originId:"M4",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"M5",placable:!0},{cellId:"M6",placable:!1},{cellId:"M7",placable:!1},{cellId:"M8",placable:!0,originId:"M9"},{cellId:"M9",originId:"M9",fmsType:"rack",direction:"E",rowGrid:1,colGrid:2},{cellId:"M10",placable:!0},{cellId:"M11",placable:!0},{cellId:"M12",placable:!0},{cellId:"M13",placable:!0},{cellId:"M14",placable:!0},{cellId:"M15",placable:!0},{cellId:"M16",placable:!0},{cellId:"M17",placable:!0},{cellId:"M18",placable:!0},{cellId:"M19",placable:!0},{cellId:"M20",placable:!0},{cellId:"M21",placable:!0},{cellId:"N1",placable:!0},{cellId:"N2",placable:!0},{cellId:"N3",placable:!0},{cellId:"N4",placable:!0},{cellId:"N5",placable:!0},{cellId:"N6",placable:!0},{cellId:"N7",placable:!0},{cellId:"N8",placable:!0},{cellId:"N9",placable:!0},{cellId:"N10",placable:!0},{cellId:"N11",placable:!0},{cellId:"N12",placable:!0},{cellId:"N13",placable:!0},{cellId:"N14",placable:!0},{cellId:"N15",placable:!0},{cellId:"N16",placable:!0},{cellId:"N17",placable:!0},{cellId:"N18",placable:!0},{cellId:"N19",placable:!0},{cellId:"N20",placable:!0},{cellId:"N21",placable:!0},{cellId:"O1",placable:!0},{cellId:"O2",placable:!0},{cellId:"O3",placable:!0},{cellId:"O4",placable:!0},{cellId:"O5",placable:!0},{cellId:"O6",placable:!0},{cellId:"O7",placable:!0},{cellId:"O8",placable:!0},{cellId:"O9",placable:!0},{cellId:"O10",placable:!0},{cellId:"O11",placable:!0},{cellId:"O12",placable:!0},{cellId:"O13",placable:!0},{cellId:"O14",placable:!0},{cellId:"O15",placable:!0},{cellId:"O16",placable:!0},{cellId:"O17",placable:!0},{cellId:"O18",placable:!0},{cellId:"O19",placable:!0},{cellId:"O20",placable:!0},{cellId:"O21",placable:!0},{cellId:"P1",placable:!0},{cellId:"P2",placable:!0,originId:"P3"},{cellId:"P3",originId:"P3",fmsType:"crac",direction:"N",rowGrid:2,colGrid:1},{cellId:"P4",placable:!0},{cellId:"P5",placable:!0,originId:"P6"},{cellId:"P6",originId:"P6",fmsType:"crac",direction:"N",rowGrid:2,colGrid:1},{cellId:"P7",placable:!0},{cellId:"P8",placable:!0,originId:"P9"},{cellId:"P9",originId:"P9",fmsType:"crac",direction:"N",rowGrid:2,colGrid:1},{cellId:"P10",placable:!0},{cellId:"P11",placable:!0},{cellId:"P12",placable:!0},{cellId:"P13",placable:!0},{cellId:"P14",placable:!0},{cellId:"P15",placable:!0},{cellId:"P16",placable:!0},{cellId:"P17",placable:!0},{cellId:"P18",placable:!0},{cellId:"P19",placable:!0},{cellId:"P20",placable:!0},{cellId:"P21",placable:!0}]},v=["1U","2U","4U","8U","10U"],C=[1,1,1,1,2,2,4,8,10],E={backgroundColor:"#eeeeee"},g={position:{x:10,y:10,z:0},lookAt:{x:0,y:0,z:0}},U=document.querySelector("#app");class W{constructor(){b(this,"_renderer");b(this,"_scene");b(this,"_camera");b(this,"_modelMap",{});b(this,"_deviceTextureMap",{});b(this,"_container",U);b(this,"_stats");this._setup(),this._render()}async _setup(){this._setupScene(),this._setupRenderer(),this._setupCamera(),this._setupLight(),this._setupResize(),this._setupControls(),this.stats=new x,document.body.appendChild(this.stats.dom),await this._loadModels(),this._addModel(),this._renderer.render(this._scene,this._camera)}_setupScene(){this._scene=new z,this._scene.background=new w(E.backgroundColor)}updateBackgroundColor(l){this._scene.background.set(l)}_setupRenderer(){this._renderer=new A({antialias:!0}),this._renderer.setPixelRatio(window.devicePixelRatio),this._container.appendChild(this._renderer.domElement)}_setupCamera(){const{clientWidth:l,clientHeight:c}=this._container;this._camera=new D(75,l/c,.1,1e3),this._camera.position.x=g.position.x,this._camera.position.z=g.position.z,this._camera.position.y=g.position.y,this._camera.lookAt(g.lookAt.x,g.lookAt.y,g.lookAt.z)}_setupLight(){}_setupResize(){const{clientWidth:l,clientHeight:c}=this._container;this._renderer.setSize(l,c),this._camera.aspect=l/c,this._camera.updateProjectionMatrix(),window.addEventListener("resize",this._setupResize.bind(this))}_setupControls(){new L(this._camera,this._container)}_setupHelper(){const l=new F(20);this._scene.add(l)}async _render(){this.stats.begin(),this._renderer.render(this._scene,this._camera),this.stats.end(),requestAnimationFrame(this._render.bind(this))}async _loadModels(){const l=new H,c=["real_rack","rack","tile","wall","crac","ups","battery","unplaceableTile",...v],r=await Promise.all(c.map(t=>{const a=`/3d_demo/${t}.glb`;return l.loadAsync(a)}));c.forEach((t,a)=>{r[a].scene,this._modelMap[t]=r[a].scene})}_addModel(){this.mapRender(),this.addGUI(),this.invisibleWallRender(),this.visibleWallRender(),this.renderLight()}renderLight(){let l={color:16777215,distance:20,intensity:30,positionDistance:6,helperVisible:!0};const c=[{x:l.positionDistance,y:5,z:0},{x:-l.positionDistance,y:5,z:0},{x:0,y:5,z:0},{x:0,y:5,z:l.positionDistance},{x:0,y:5,z:-l.positionDistance}],r=[],t=[];c.forEach((e,i)=>{const o=new O(l.color,l.intensity,l.distance);o.position.set(e.x,e.y,e.z),this._scene.add(o),r.push(o);const n=new N(o,1,"orange");t.push(n),this._scene.add(n)});const a=new S(4210752,.3);this._scene.add(a);const d=this.gui.addFolder("조명");d.addColor(l,"color").name("빛의 색상").onChange(e=>{r.forEach(i=>{i.color.set(new w(e))})}),d.add(l,"intensity",0,100,1).name("빛의 강도").onChange(e=>{r.forEach(i=>{i.intensity=e})}),d.add(l,"distance",0,100,1).name("조명이 미치는 거리").onChange(e=>{r.forEach(i=>{i.distance=e})}),d.add(l,"positionDistance",0,100,1).name("조명 사이의 거리").onChange(e=>{r[0].position.x=e,r[1].position.x=-e,r[3].position.z=e,r[4].position.z=-e}),d.add(l,"helperVisible").name("광원 헬퍼 토글").onChange(e=>{t.forEach(i=>{i.visible=e})})}invisibleWallRender(){const l=this._modelMap.tile,{x:c}=this.getObjectSize(l),t=this._modelMap.wall.clone();t.traverse(e=>{e instanceof R&&(e.material=e.material.clone(),e.geometry=e.geometry.clone())});const a=t.children[0].children[0].material;a.transparent=!0,a.opacity=.5;const d=this.gui.addFolder("불투명 벽 색상");d.addColor(a,"color").onChange(e=>{a.color.set(new w(e))}),d.add(a,"opacity",0,1,.01).onChange(e=>{a.opacity=e}),t.rotation.y=Math.PI/2,t.position.x-=c/2,t.position.z=c*2,t.scale.set(1,1.2,16),this._scene.add(t)}visibleWallRender(){const l=this._modelMap.tile,{x:c}=this.getObjectSize(l),r=this._modelMap.wall.clone(),t=this.gui.addFolder("투명 벽 색상"),a=r.children[0].children[0].material;a.transparent=!0,a.opacity=.5,t.addColor(a,"color").onChange(p=>{a.color=new w(p)}),t.add(a,"opacity",0,1,.01).onChange(p=>{a.opacity=p});const d=.7,e=r.clone();e.scale.set(1.5,d,5),e.position.x=c*5,e.position.z=c*6.5;const i=e.clone();i.position.x=0,this._scene.add(i),this._scene.add(e);const o=r.clone();o.rotation.y=Math.PI/2,o.scale.set(1.5,d,5),o.position.x=c*2.5,o.position.z=c*4;const n=o.clone();n.position.z=c*9,this._scene.add(o),this._scene.add(n);const I=r.clone(),{x:f,y:G,z:h}=this.getObjectSize(I);I.rotation.z=Math.PI/2,I.position.set(c*5,G*d,c*6.5),I.scale.set(1,1.25,5),this._scene.add(I)}addGUI(){this.gui=new J,this.gui.addFolder("배경 색상").addColor(E,"backgroundColor").onChange(c=>{this._scene.background.set(c)})}wallRender(){const{maxRow:l,maxCol:c}=M,r=this._modelMap.tile,{x:t}=this.getObjectSize(r),a=-1*(c/2)*t,d=l/2*t;for(const e of wallInfo){const[i,o]=e.split("_"),{row:n,col:I}=this.cellIdToRowCol(i),{row:f,col:G}=this.cellIdToRowCol(o);if(I===G){const h=d+n*t,p=a-I*t+t/2,s=this._modelMap.wall.clone();s.position.set(h,0,p),s.rotation.y=Math.PI/2,this._scene.add(s)}if(n===f){const h=d+n*t+t/2,p=a+I*t,s=this._modelMap.wall.clone();s.position.set(h,0,p),this._scene.add(s)}}}mountDevice(l,c){const t=c/79.7,a=1.75,d=4.1;let e=0;for(;;){const i=C[Math.floor(Math.random()*C.length)];if(e+i>=42)break;if(Math.random()<.3){e+=i;continue}const o=this._modelMap[`${i}U`].clone(),I=(e+i/2)*a+d;o.position.y=I*t,l.add(o),e+=i}}getObjectSize(l){const c=new K().setFromObject(l),r=new B;return c.getSize(r),r}mapRender(){const{cellInfos:l,maxRow:c,maxCol:r}=M,t=this._modelMap.tile,{x:a}=this.getObjectSize(t),{y:d}=this.getObjectSize(this._modelMap.rack),e=-1*(r/2)*a,i=c/2*a;for(let o=0;o<l.length;o+=1){const n=l[o],{cellId:I,originId:f}=n,{row:G,col:h}=this.cellIdToRowCol(I),p=e+h*a,s=i-G*a,y=this._modelMap[n.placable?"tile":"unplaceableTile"].clone();if(y.position.set(s,0,p),this._scene.add(y),I!==f||n.placable)continue;const{fmsType:_,direction:k}=n,m=this._modelMap[_==="rack"?"real_rack":_].clone();m.rotation.y=this.directionToRotation(k),m.position.set(s,0,p),_==="rack"&&(this.mountDevice(m,d),m.scale.set(1.2,1,1.25)),this._scene.add(m)}}directionToRotation(l){if(l==="N")return 0;if(l==="S")return Math.PI;if(l==="E")return Math.PI/2*3;if(l==="W")return Math.PI/2}cellIdToRowCol(l){const c=l.match(/^([A-Z]+)(\d+)$/);if(!c)return null;const[,r,t]=c;let a=0;for(let d=0;d<r.length;d+=1)a=a*26+(r.charCodeAt(d)-64);return{row:a,col:Number(t)}}}new W;
